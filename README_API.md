# PlantMon-AdvX API 对接说明

## 🎉 后端接口对接完成

本项目已成功完成后端API接口对接，所有数据现在都从真实的后端服务动态获取。

## 📋 已完成的功能

### ✅ API服务层

- **API配置管理**: 统一的API配置和环境变量支持
- **HTTP客户端**: 封装的HTTP请求工具，支持超时控制和错误处理
- **接口封装**: 完整封装所有后端接口调用

### ✅ 接口对接

1. **健康检查** (`/health`) - 检查后端服务状态
2. **植物列表** (`/plants`) - 获取所有已记录植物
3. **植物详情** (`/plants/{latin_name}`) - 获取指定植物详细信息
4. **图片处理** (`/process`) - 上传图片进行植物识别和植宠生成

### ✅ 页面更新

- **首页**: 显示真实的出战植宠数据
- **拍照页**: 使用真实API进行植物识别
- **图鉴页**: 从API加载植宠列表
- **详情页**: 显示API返回的植宠详细信息

### ✅ 状态管理

- **Pinia Store**: 完全重构以使用API数据
- **加载状态**: 全面的加载状态管理
- **错误处理**: 完善的错误处理和用户提示
- **数据缓存**: 智能的数据缓存和更新机制

## 🔧 配置说明

### 环境变量配置

创建 `.env` 文件并配置API基础URL：

```bash
# API基础URL - 后端服务地址
VITE_API_BASE_URL=http://localhost:8000
```

### API配置文件

API配置位于 `src/config/api.ts`：

```typescript
export const API_CONFIG = {
  BASE_URL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000',
  ENDPOINTS: {
    HEALTH: '/health',
    PLANTS: '/plants',
    PLANT_DETAIL: '/plants',
    PROCESS: '/process',
  },
  TIMEOUT: 30000,
  DEFAULT_HEADERS: {
    'Content-Type': 'application/json',
  },
}
```

## 🚀 使用方式

### 启动项目

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 后端服务要求

确保后端服务运行在配置的URL上，并实现以下接口：

1. **GET /health** - 健康检查
2. **GET /plants** - 获取植物列表
3. **GET /plants/{latin_name}** - 获取植物详情
4. **POST /process** - 处理植物图片

## 📊 数据流程

### 应用启动流程

1. 应用启动时自动检查后端服务健康状态
2. 如果服务可用，从API加载植宠数据
3. 如果服务不可用，使用本地模拟数据作为备用

### 拍照识别流程

1. 用户拍照后，将图片转换为File对象
2. 调用 `/process` 接口上传图片
3. 后端返回识别结果和生成的植宠数据
4. 前端更新本地数据并显示结果

### 数据同步机制

- 植宠数据基于拉丁名称进行唯一标识
- 支持从数据库缓存和新生成两种数据来源
- 自动处理数据更新和状态同步

## 🛠️ 技术特性

### 错误处理

- 网络错误自动重试机制
- 用户友好的错误提示
- 优雅的降级处理（API不可用时使用模拟数据）

### 性能优化

- 请求去重和缓存
- 并发请求优化
- 图片懒加载和错误处理

### 类型安全

- 完整的TypeScript类型定义
- API响应数据类型检查
- 编译时类型安全保证

## 🔍 调试和监控

### 控制台日志

应用会在控制台输出详细的API调用日志，包括：

- 请求状态和响应时间
- 错误信息和重试状态
- 数据加载和更新状态

### 健康检查

可以通过访问 `/health` 接口检查后端服务状态：

```bash
curl http://localhost:8000/health
```

## 🎯 下一步计划

- [ ] 添加用户认证和会话管理
- [ ] 实现植宠数据的本地持久化
- [ ] 添加离线模式支持
- [ ] 优化图片上传和处理性能

## 📞 技术支持

如有任何问题或需要技术支持，请查看：

1. API文档: `Docs/API.md`
2. 开发计划: `Docs/开发计划.md`
3. 项目源码注释和类型定义
